<UserControl x:Class="AlhimikGame.WPF.Views.ElixirCreationProcessView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:AlhimikGame.WPF.Views"
             xmlns:converters="clr-namespace:AlhimikGame.WPF.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">
    
    <UserControl.Resources>
        <converters:IngredientImageConverter x:Key="IngredientImageConverter"/>
        <Storyboard x:Key="MixingAnimation">
            <DoubleAnimation
                Storyboard.TargetName="CauldronContent"
                Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                From="0" To="360" Duration="0:0:1" RepeatBehavior="5x" />
        </Storyboard>
        
        <!-- Colors from the screenshot -->
        <SolidColorBrush x:Key="BackgroundColor" Color="#1E1F31"/>
        <SolidColorBrush x:Key="PrimaryColor" Color="#6750A4"/>
        <SolidColorBrush x:Key="AccentColor" Color="#9373FF"/>
        <SolidColorBrush x:Key="TextColor" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="SecondaryTextColor" Color="#B8B8B8"/>
        <SolidColorBrush x:Key="CardColor" Color="#282942"/>
        
        <!-- Button Style -->
        <Style x:Key="PurpleButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryColor}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                              VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource AccentColor}"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <!-- Card Style -->
        <Style x:Key="CardBorder" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardColor}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Direction="270" Opacity="0.2" Color="Black"/>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    
    <Grid Background="{StaticResource BackgroundColor}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Page Title -->
        <TextBlock Grid.Row="1" 
                   Text="Алхімічна лабораторія" 
                   FontSize="24" 
                   Foreground="{StaticResource TextColor}" 
                   Margin="20,20,0,10"/>
        
        <!-- Main content area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Ingredients List -->
            <Border Grid.Column="0" 
                    Style="{StaticResource CardBorder}"
                    Margin="20,10,10,20">
                <DockPanel>
                    <TextBlock Text="Доступні інгредієнти" 
                               FontSize="16" 
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextColor}" 
                               DockPanel.Dock="Top"
                               HorizontalAlignment="Center"
                               Margin="0,15,0,15"/>
                    
                    <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                  HorizontalScrollBarVisibility="Disabled">
                        <ListBox ItemsSource="{Binding Ingredients}"
                                 Name="IngredientsList"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Margin="10,0,10,10">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0,5"/>
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <ContentPresenter/>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#32334D" 
                                            CornerRadius="8" 
                                            Padding="10" 
                                            Margin="2"
                                            BorderThickness="0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <!-- Ingredient Image -->
                                            <Border Grid.Column="0" 
                                                    Background="#3E405C" 
                                                    CornerRadius="6"
                                                    Width="48" Height="48" 
                                                    Margin="0,0,10,0">
                                                <Image Source="{Binding Ingredient.Name, Converter={StaticResource IngredientImageConverter}}" 
                                                       Width="32" Height="32" 
                                                       ToolTip="{Binding Description}"
                                                       MouseDown="Ingredient_MouseDown"/>
                                            </Border>
                                            
                                            <!-- Ingredient Info -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Name}" 
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextColor}"
                                                           TextWrapping="Wrap"/>
                                                <TextBlock Text="{Binding Quantity, StringFormat='Потрібно: {0}'}" 
                                                           Foreground="{StaticResource SecondaryTextColor}"
                                                           FontSize="11"
                                                           Margin="0,2,0,0"/>
                                                <TextBlock Text="{Binding Added, StringFormat='Додано: {0}'}" 
                                                           Foreground="#9373FF"
                                                           FontSize="11"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </ScrollViewer>
                </DockPanel>
            </Border>
            
            <!-- Witch and Cauldron Area -->
            <Border Grid.Column="1" 
                    Style="{StaticResource CardBorder}"
                    Margin="10,10,20,20">
                <Grid>
                    <!-- Background elements -->
                    <Rectangle Fill="#2D2E49" 
                               HorizontalAlignment="Stretch" 
                               VerticalAlignment="Bottom" 
                               Height="140"/>
                    
                    <!-- Witch Image -->
                    <Image Source="/AlhimikGame.WPF;component/Assets/witch.jpg" 
                           HorizontalAlignment="Right" 
                           VerticalAlignment="Center"
                           Height="280"
                           Margin="0,0,40,40"/>
                    
                    <!-- Cauldron/Bowl -->
                    <Grid HorizontalAlignment="Center" 
                          VerticalAlignment="Bottom"
                          Margin="0,0,0,50">
                        
                        <!-- Cauldron Base -->
                        <Grid>
                            <Ellipse Height="100" 
                                     Width="200" 
                                     Fill="#282A42" 
                                     Stroke="#393B58" 
                                     StrokeThickness="3"/>
                            
                            <Rectangle Height="80" 
                                       Width="160" 
                                       Fill="#282A42" 
                                       Stroke="#393B58" 
                                       StrokeThickness="3"
                                       VerticalAlignment="Top"/>
                            
                            <!-- Cauldron Content -->
                            <Ellipse x:Name="CauldronContent"
                                     Height="80" 
                                     Width="160" 
                                     Fill="#9373FF" 
                                     Opacity="0.6"
                                     RenderTransformOrigin="0.5,0.5">
                                <Ellipse.RenderTransform>
                                    <RotateTransform Angle="0"/>
                                </Ellipse.RenderTransform>
                            </Ellipse>
                        </Grid>
                        
                        <!-- Drop Target for Ingredients -->
                        <Rectangle x:Name="DropTarget"
                                   Height="100" 
                                   Width="180" 
                                   Fill="Transparent" 
                                   AllowDrop="True"
                                   DragEnter="DropTarget_DragEnter"
                                   DragLeave="DropTarget_DragLeave"
                                   Drop="DropTarget_Drop"/>
                        
                        <!-- Highlight for drop target -->
                        <Rectangle x:Name="DropHighlight"
                                   Height="100" 
                                   Width="180" 
                                   Stroke="#9373FF" 
                                   StrokeThickness="3"
                                   StrokeDashArray="3 2"
                                   Visibility="Collapsed"/>
                        
                        <!-- Current instruction -->
                        <Border Background="#32334D"
                                CornerRadius="8"
                                Padding="10,5"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Top"
                                Margin="0,-50,0,0">
                            <TextBlock x:Name="CurrentInstructionText"
                                       Text="{Binding CurrentInstruction}" 
                                       Foreground="White"
                                       FontSize="14"
                                       TextAlignment="Center"/>
                        </Border>
                    </Grid>
                    
                    <!-- Instructions Header -->
                    <TextBlock Text="Додавайте інгредієнти по одному до котла" 
                               FontSize="18"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextColor}" 
                               HorizontalAlignment="Center" 
                               VerticalAlignment="Top"
                               Margin="0,20,0,0"/>
                </Grid>
            </Border>
        </Grid>
        
        <!-- Bottom controls -->
        <Border Grid.Row="3" 
                Background="#282942" 
                BorderThickness="0,1,0,0" 
                BorderBrush="#3A3B52">
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Center"
                        Margin="20,15">
                <Button x:Name="StartMixingBtn" 
                        Content="Почати змішування" 
                        Style="{StaticResource PurpleButton}"
                        IsEnabled="{Binding CanStartMixing}"
                        Click="StartMixing_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>